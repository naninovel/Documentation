# 1.17 Release Notes

Release date: Jul 2021

> [!CAUTION]
> **This release is out of support and won't receive any new features or bug fixes.** Consider upgrading to the latest stable or preview release as soon as possible. Note that supported (stable and preview) releases are not published on Unity's Asset Store; [register your license](https://naninovel.com/register) to access them.

## Compatibility

Supported Unity versions range: from `2019.4.30` to `2021.2`. Previous versions are not supported; compatibility issues with newer (major) versions will be addressed once they're out of beta.

Recommended Unity version: [`2019.4.30`](https://unity3d.com/unity/whats-new/2019.4.30).

## Upgrade Guide

When importing the package to a project with Naninovel version `1.15` or older first follow [v1.16 release](/releases/1.16) upgrade guide, then continue with the following instructions:

1. Remove `Naninovel` folder from the project before importing the updated package.
2. In case using extension packages, update them: [Spreadsheet](https://github.com/Naninovel/Spreadsheet/raw/main/NaninovelSpreadsheet.unitypackage), [Live2D](https://github.com/Naninovel/Live2D/raw/master/NaninovelLive2D.unitypackage), [Spine](https://github.com/Naninovel/Spine/raw/main/NaninovelSpine.unitypackage), [Inventory](https://github.com/Naninovel/Inventory/raw/master/NaninovelInventory.unitypackage), [PlayMaker](https://github.com/Naninovel/PlayMaker/raw/master/NaninovelPlayMaker.unitypackage), [AdventureCreator](https://github.com/Naninovel/AdventureCreator/raw/master/NaninovelAdventureCreator.unitypackage).
3. In case using message sound option for characters, select the playback type with the newly added `Message Sound Playback` option.
4. In case using engine's async APIs (eg, custom commands), change `CancellationToken` to `AsyncToken`. ([example](https://i.gyazo.com/fc5e8e75b0db0e0ac9d14da663a136b6.png))
5. In case using `Reveal SFX` in a text printer, use either the newly added `On Reveal Started` and `On Reveal Finished` events ([example](https://i.gyazo.com/7193e90b97a8f4bf4de2c6987eb6fb11.png)) or `Chars SFX` property.
6. Remove `UniRx.Async` usings from custom async C# scripts (they're no longer required to reference `UniTask` types).

Remember to keep `NaninovelData` folder when updating the engine to preserve project configuration and asset references.

Be aware, that in-game saves (slots in save/load menu, values in settings menu and global game state) created with previous versions could cause unexpected behavior when loaded with the updated version; when patching a shipped project with a new Naninovel version, make sure existing saves work as expected.

In case using [VS Code IDE extension](/guide/ide-extension), check for updates.

## Added

- Added audio support for video actors.
- Added `Add Ruby Line Height` property to Naninovel TMPro Text component allowing to disable auto line height compensation for the lines that contain ruby text. Disable and increase default text line height to ensure equal height for all lines when using ruby tags. ([example](https://i.gyazo.com/49485f28be6681a5379a45c4cfb84c10.png))
- Added `RevealableTMProText (Extra Effects)` revealable shader for TMPro text based on full SDF shader bundled with TMPro (the default one is based on mobile version). ([example](https://i.gyazo.com/e593dc05957c1396bbcaf4a08c385416.png))
- Added `Authored Template` property to text printer actor configuration allowing to specify processing for printed text messages with an author (direct speech). ([guide](https://github.com/Naninovel/Documentation/blob/3c2f65ca91d6b479ab1562e11874822aea868ca8/docs/guide/text-printers.md#authored-template))
- Added `Toggle Skip` default input allowing to toggle skip input mode; default bindings are Tab on keyboard and right stick press on gamepad. To use the input in existing projects, add the binding in input configuration or input actions asset when using new input system. ([example](https://i.gyazo.com/9a79c036cdf0370ce162507e1e4e8126.png))
- Added `Warn Untranslated` option to localization utility. When enabled and generating documents with `Try Update` enabled, will log warnings when untranslated lines are found. ([example](https://i.gyazo.com/9cbf505d17decba7440dde417664c16c.png))
- Added invert option to custom transition. To invert, specify `1` as second parameter, eg: `@back Appearance.Custom dissolve:Textures/Spiral params:,1`.
- Added `time` parameter to `@movie` command allowing to control the fade-in/out duration.
- Added `Message Sound Playback` option to character metadata configuration allowing to select the sound playback type (looped, one shot or clipped).
- Added universal serialization handlers (selected by default in new projects).
- Added `Engine.OnDestroyed` event invoked when the engine is destroyed.
- Added `Exclude From Reset` property to new game button of default title UI, allowing to exclude specific engine services from state reset when starting a new game. ([example](https://i.gyazo.com/443a8d02e22d170a2fbcaae0d308c1b6.png))
- Added `On Reveal Started` and `On Reveal Finished` Unity events to the text printers. ([example](https://i.gyazo.com/7193e90b97a8f4bf4de2c6987eb6fb11.png))
- Added an option for the text char reveal routines (char commands and char sfx) to trigger on any char; leave `Characters` field empty for that.
- Added `On Unlocked` and `On Locked` Unity events to `Unlockable Trigger` component.
- Added `Wait By Default` option to script player configuration allowing to control whether the player should wait the played commands when `wait` parameter is not explicitly specified.
- Added `Delete` input binding (delete keyboard and gamepad pause button by default) and an option to delete save-load slots with a gamepad and keyboard. ([example](https://i.gyazo.com/d94db41b2c0e99272c63ea33339cc1bc.png))
- Added `Disable Wait Input` option to `Play Script` component allowing to disable waiting for input mode when the script is played. ([example](https://i.gyazo.com/3bb2ffc85cd37d5225677ee89758b3e4.png))
- Added UI navigation focus support for generic HID gamepads.
- Added `Default Duration` to the actor, camera and audio configurations allowing to set default duration of the modification commands; default value of the `time` parameter is no longer hard-coded.
- Added `Choice Button Loader` property to choice configuration allowing to load custom button prefabs without `Resources` API (eg, via addressable or any other resource provider). ([example](https://i.gyazo.com/9b50d543b5a6843b13b415c3c2ae9641.png))
- Added load progress indicator to loading and engine initialization UIs. ([example](https://i.gyazo.com/5e86beb39cfdbd895feec3c18f6e81a9.gif))
- Video actors now fade the volume when changing appearances or hiding/showing.
- Text preview printer now accepts any implementations of `IRevealableText` interface for better extensibility.
- Script player will now attempt to find nearest playable inline index when loading state; will prevent crash when using localized scripts with extra commands, but could still lead to an undefined behavior (warning is logged in such cases).
- Most of the built-in async methods will now automatically handle async cancellation; it's no longer required to check for cancellation after awaiting such methods.
- Spreadsheet extension now supports organizing the scripts in subfolders.
- New line symbols (`\n`) are now supported in managed text documents.
- `@set` command now supports compound assignment (`+=`, `-=`, `/=`, `*=`).
- IDE extension will now show default parameter values. ([example](https://i.gyazo.com/5e5df49db7e8d9a5137760292523b0f2.png))
- IDE extension will now provide autocomplete for look direction parameter.
- It's now possible to update project metadata with a menu or a ctrl+shift+U hotkey. ([example](https://i.gyazo.com/c1a9ea4c2933a2ee5e655b2558e778bf.png))
- Project metadata is now automatically generated and synced with IDE.
- IDE extension now shows currently played line and allows navigating scenario scripts. ([guide](https://www.youtube.com/watch?v=TA-kx6B9uD8))
- It's now possible to combine layered composition keys with expressions, eg `@char Miho.Uniform,Hair/Front>Short`.
- Spreadsheet extension now support long script names when `Single Spreadsheet` is disabled.
- It's now possible to use UI Toolkit as Naninovel UIs. ([example](https://github.com/Naninovel/UIToolkit))

## Changed

- Minimum supported and recommended Unity version changed to 2019.4.30 due to a regression fix (https://github.com/Naninovel/Documentation/issues/138).
- Changed movie player service and associated UI APIs. Instead of `OnMovieTextureReady` event use `PlayAsync` method to get the movie texture and assign it to the UI with `SetMovieTexture`; see `Commands/PlayMovie.cs` implementation for example.
- Removed `Clip Message Sound` option from character metadata configuration and text printers; select `One Shot Clipped` in the newly added `Message Sound Playback` option instead.
- Changed async cancellation API: `CancellationToken` struct has been renamed to `AsyncToken`, `CancelASAP` and `CancelLazy` properties to `Canceled` and `Completed` respectively. When a token is canceled `AsyncOperationCanceled` exception will now be thrown.
- `UniRx.Async` using is no longer required when using `UniTask` types.
- When creating a new naninovel script with a name that already exist in script resources, an error will be logged and script won't be created.
- Removed `Reveal SFX` from text printers; use the newly added reveal events, `Chars SFX` or character message sounds.
- Removed `IDE Metadata` tool. The metadata is now automatically generated and synced with IDE (can be disabled in the engine configuration).
- Renamed `IDE...` attributes to `...Context`.

## Fixed

- Fixed compatibility issues with Unity 2021.2
- Fixed revealable TMPro sprite shader (emoji will reveal correctly when emoji texture is assigned directly to the material; see UI project for example).
- Fixed (harmless) errors when generating localization scripts form other localization scripts with "Try Update" enabled and some of the target scripts missing.
- Fixed audio continue playing after hiding a video actor.
- Fixed message sound not clipped properly.
- Fixed font size associated with zero index not applied when restarting the game.
- Fixed custom camera component state not restored to initial state on service reset.
- Fixed `On Look Direction Changed` event of generic actors not invoked in some cases.
- Fixed exception when removing actor from scene while an un-awaited command associated with the actor is running.
- Fixed touches not working with Unity Remote.
- Fixed position not applied when using `pos` parameter in `@spawn` command to spawn built-in rain, snow and sun shafts effects.
- Fixed extra quotes added when setting values with whitespace in visual script editor.
- Fixed trigger frequency of the text reveal routines (char commands, char sfx and author message sounds) depending on frames per second.
- Fixed transition effect shader warnings when building the player for the first time.
- Fixed compatibility issues with input system v1.1-preview5.
- Fixed incorrect resource path info showed on actor records when single-resource implementation is selected.
- Fixed list parameters not resolving omitted values correctly.
- Fixed escaped quotes escaped again when saving via visual script editor.
- Fixed default camera position being offset by z-axis.
- Fixed some editor labels missing in Unity 2021.
- Fixed reveal print speed ignored when text fade is disabled.
- Fixed bug in command parameter implicit cast to nullable types.
- Fixed sun shafts particles initially spawning at incorrect position.
- Fixed default state not applied on actor initialization.
- Fixed text reveal effect clipping after changing font size.
- Fixed input indicator incorrect position after changing font size.
- Fixed hidden UI interactable state overridden when showing a modal UI.
