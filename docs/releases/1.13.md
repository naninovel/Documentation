# 1.13 Release Notes

Release date: Aug 2020

> [!CAUTION]
> **This release is out of support and won't receive any new features or bug fixes.** Consider upgrading to the latest stable or preview release as soon as possible. Note that supported (stable and preview) releases are not published on Unity's Asset Store; [register your license](https://naninovel.com/register) to access them.

## Compatibility

Supported Unity versions range: from `2019.4.7` to `2020.2`. Previous versions are not supported; compatibility issues with newer (major) versions will be addressed once they're out of beta.

Recommended Unity version: [Latest `2019.4` LTS release](https://unity3d.com/unity/qa/lts-releases?version=2019.4).

## Upgrade Guide

When importing the package to a project with Naninovel version `1.11` or older first follow [v1.12 release](/releases/1.12) upgrade guide, then continue with the following instructions:

1. Remove `Naninovel` folder from the project before importing the updated package.
2. In case you're using extension packages, update them using following links:
    - [NaninovelPlayMaker](https://github.com/Elringus/NaninovelPlayMaker/raw/master/NaninovelPlayMaker.unitypackage)
    - [NaninovelLive2D](https://github.com/Elringus/NaninovelLive2D/raw/master/NaninovelLive2D.unitypackage)
    - [AdventureCreator](https://github.com/Elringus/NaninovelAdventureCreator/raw/master/NaninovelAdventureCreator.unitypackage)
3. In case you're using a custom "ChatMessage" prefab for built-in chat printer, assign `OnMessageTextChanged` Unity event for the prefab. ([example](https://i.gyazo.com/c69046e5d6b78ada10c0b84d30b5f3cd.png))
4. In case you're using a custom `ITipsUI` with built-in implementation, assign `Items Scroll Rect` property. ([example](https://i.gyazo.com/c52f6d2e10ff4e719790a10f0be97c25.png))
5. In case you're using a custom "SaveLoadSlot" prefab, assign `Empty Slot Thumbnail` property.
6. In case you've removed `com.unity.textmeshpro` package (added by default when creating a new Unity project), add it back, as Naninovel will no longer compile without the package.
7. In case you're using custom metadata types, remove the attribute from the implementations and inherit them from `CustomMetadata<>`. Be aware, that values of the custom metadata properties will be lost after the changes, so make sure to backup them.
8. In case using a custom actor implementation, apply `ActorResources` attribute and revise how the resources are loaded: if the implementation uses multiple resources, add the attribute and set second argument true, otherwise change path of the loaded single resource to be equal to the actor ID.
9. In case using custom preloadable commands or actor implementations with overridden `Hold/ReleaseResources` methods, change the signature of the hold and release methods to comply with the new interface. ([example](https://i.gyazo.com/5be518d72b3654d6fe0365a43a085b92.mp4))
10. In case you've used a sprite characters without appearances to represent a narrator, switch to `NarratorCharacter` implementation (sprite implementations will now show a special texture when an appearance is missing).
11. In case using any custom types under a non-predefined assembly (via .asmdef files) to extend or override engine behavior (eg, actor implementations, serialization handlers, custom configurations, etc), add the assembly name to the `Type Assemblies` list property found in the engine configuration menu.
12. In case using custom configurations, apply `EditInProjectSettings` attribute if you need the associated project settings menu.
13. Run `Naninovel -> Upgrade -> v1.12 to v.13` upgrade script.

Remember to keep `NaninovelData/Resources` folder and `NaninovelData/EditorResources.asset` file when updating the engine to preserve project configuration and asset references.

Be aware, that in-game saves (slots in save/load menu, values in settings menu and global game state) created with previous versions could cause unexpected behavior when loaded with the updated version; when patching a shipped project with a new Naninovel version, make sure existing saves work as expected.

In case you're using [VS Code IDE extension](/guide/ide-extension), check for updates to handle changes in the commands API.

## Added

- IDE extension for VS Code is now available. ([guide](https://github.com/Elringus/NaninovelWeb/blob/ea4c6d9bad462613be7a60dd8965a19bc6c7c43f/docs/guide/ide-extension.md))
- It's now possible to render character and background actors to render texture assets assigned in configuration; supported by all the implementations, except generic. ([guide](https://github.com/Elringus/NaninovelWeb/blob/e59aaff1e4dc98c9339c163643cf0ff132d47b76/docs/guide/characters.md#render-to-texture))
- It's now possible to execute commands via title script before starting a new game, exiting game or loading a game with `OnNewGame`, `OnExit` and `OnLoad` labels. ([guide](https://github.com/Elringus/NaninovelWeb/blob/2be7a54eb1641923aa2b43ba45e8ec5641b3e6bd/docs/guide/naninovel-scripts.md#title-script))
- It's now possible to associate printed text with tips to auto unlock them and show tips UI when the associated text clicked. ([guide](https://github.com/Elringus/NaninovelWeb/blob/25a2cc1cff2a84ac08120d5575e08d2d1c428766/docs/guide/unlockable-items.md#tips-in-printers))
- It's now possible to specify y and z coordinates with `from` and `to` parameters of `@slide` command.
- It's now possible to disable opacity hover of grid slots (CG, save-load, etc), by setting `Hover Opacity` to zero.
- It's now possible to assign asset references to custom metadata.
- It's now possible to assign script expression to display name. ([guide](https://github.com/Elringus/NaninovelWeb/blob/6b2f638035c90b3f54d1d3d00aee1221ed5e7320/docs/guide/characters.md#display-names))
- It's now possible to override built-in configuration editors (Naninovel project settings menus). ([guide](https://github.com/Elringus/NaninovelWeb/blob/13a63996c0871aea970fcd12fcd8a8f2a8509c04/docs/guide/custom-configuration.md#overriding-built-in-editors))
- Improved script line searcher styling for better visibility when using dark Unity editor skin.
- Improved engine initialization and localization change times by using a stripped version of the domain types.
- Improved performance when state rollback is disabled (controlled via state configuration menu). The engine will no longer perform full serialization on each played command, which was previously required to save the game; this significantly reduce GC allocations and saves CPU time when playing scripts with rollback disabled.
- Added support for Unity 2020.2.
- Added "DicedSpriteBackground" background actor implementation; configured and used in the same way as diced characters.
- Added support for direct interaction (eg, raycasting) with the models of Live2D character implementation.
- Added `ActorResources` attribute, allowing to specify resource type constraint and whether an actor implementation is allowed to have multiple resources assigned in configuration menu.
- Added `NarratorCharacter` implementation for character actors that doesn't have any presence on scene and can be used to represent a narrator (author of the printed text messages).
- Added `EditInProjectSettings` attribute; when the attribute is applied to a configuration implementation, the associated project settings editor menu will be added.
- Added `PrintFrameDelay` property to text printer metadata allowing to specify number of frames to wait before completing `@print` commands; a value greater than zero is required to make the printed text visible while in skip mode.
- Added `Type Assemblies` list property to the engine configuration menu allowing to specify which assemblies will be scanned when looking for actor implementations, serialization handlers, managed text, etc.
- Added `OnMessageTextChanged` Unity event to `ChatMessage` component, allowing to use it with any types of text.
- Added `AudioListener` property getter to `IAudioManager` interface, allowing to access audio listener component currently used by the engine.
- Added managed text records for the graphic options.
- Added `On Started Speaking` and `On Finished Speaking` events for layered character behavior allowing to set up lip sync.
- Added a `Font Options` list property in the UI configuration allowing to specify which fonts should be available for the player to choose from in the game settings UI. ([example](https://i.gyazo.com/4a06d2baf086175b168eb284e1f5955f.png))
- Added default option of the font dropdown setting to the auto generated "DefaultUI" managed text document.
- Added an option to specify file extension of the video assets (movies, video backgrounds) streamed under WebGL. ([example](https://i.gyazo.com/b3eb1ab2af513e6a131347d6e5e455e5.png))
- Added an option to prevent specific printers from adding messages to the backlog. ([example](https://i.gyazo.com/9f0155dff068dbe1fd821e9007cf4a5a.png))
- Added an option for a text printer to always split messages added to backlog; enabled by default for the built-in chat printer.
- Added extension methods for custom variable manager allowing to get/set variables with float, int and bool value types.
- Added a default actor appearance shown when referencing a non-existing actor via naninovel scripts.
- Added `Render Canvas` component allowing to specify custom render canvas size for layered actors.
- Added concurrent invocations support for `RuntimeInitializer.InitializeAsync()` method.
- Added `@sfxFast` command allowing to play transient SFX audio clips (eg, via `Play Script` component in reaction to UI events); the command also allows playing the same clip concurrently multiple times with `additive` parameter.
- Added `Scene Independent` option to the engine configuration menu; when disabled, the engine objects will become part of the scene the engine was initialized at and will be destroyed when the scene is unloaded.
- Added `Dynamic Load` property to the CG gallery UI; when disabled, all the CG resources will be preloaded on initialization instead of loading only the resources for the current CG gallery page.

## Changed

- TMPro (`com.unity.textmeshpro`) package is now a required dependency.
- Available fonts in the game settings will no longer be automatically extracted from the user's OS; use the added option to assign specific fonts in the UI configuration instead.
- Font selection dropdown in game settings is now hidden when no font options are added in the UI configuration menu.
- Renamed property `IUIManager.Font` to `IUIManager.FontName`.
- When `Block Input When Visible` is enabled in a custom UI, skip and auto play script player modes will now automatically be disabled on showing the UI to prevent situations where player is not able to stop the skip and auto play while the UI is visible.
- Removed `CustomMetadata` attribute; use `CustomMetadata<>` base type instead.
- Custom actor implementations no longer support multiple resources by default; use `ActorResources` attribute to configure that.
- Live2D extension package has been revamped: setup process is the same, but the character implementation no longer requires a dedicated camera for render. Live2D-dedicated configuration menu has been removed.
- Refactored resources hold-release API for better usability and maintainability: `Resource` no longer provide hold and release methods, use `ResourceLoader` instances instead.
- `Command.IPreloadable` methods has been renamed to `PreloadResourcesAsync` and `ReleasePreloadedResources` to better reflect interface purpose.
- Editor scripts from UniTask library are no longer bundled with the package.
- Project settings editor menus will no longer be automatically added for all the configuration types in the project; apply `EditInProjectSettings` attribute in case you need one for your custom configuration.
- Renamed `CharacterActorBehaviour` to `GenericCharacterBehaviour` and `BackgroundActorBehaviour` to `GenericBackgroundBehaviour` (corresponding components attached to existing prefabs are renamed automatically).
- `LayeredActorBehaviour` component is now abstract; use `LayeredCharacterBehaviour` and `LayeredBackgroundBehaviour` components instead.
- Renamed "Custom Commands" utility menu to "IDE Metadata".
- Atom IDE extension is now deprecated. Use [VS Code extension instead](https://github.com/Elringus/NaninovelWeb/blob/ea4c6d9bad462613be7a60dd8965a19bc6c7c43f/docs/guide/ide-extension.md).

## Fixed

- Fixed development console generating garbage while hidden.
- Fixed `appearance` parameter in `@char` and `@back` commands not overriding appearance set in pose.
- Fixed `@slide` command not providing script playback info when logging an error.
- Fixed naninovel script assets not updated correctly when choosing "Save" while entering play mode in the editor.
- Fixed reveal effect fails to work in TMPro printers after changing font in game settings.
- Fixed appended text messages added as separated entries in printer backlog.
- Fixed auto and skip modes retain after showing UIs, which block user input (backlog, save-load, settings, etc).
- Fixed backlog messages corruption when exceeding message capacity.
- Fixed backlog messages appear in incorrect order when loading a saved game.
- Fixed aor exception when cycling through previously entered commands in development console.
- Fixed duplicate property serialization error with "ClickThroughPanel" UI.
- Fixed editor resource provider not initialized correctly when `Disable Domain Reload` is enabled in project configuration.
- Fixed transition material loosing reference to the required textures after rollback.
- Fixed save-load UI using wrong slot prototype for quick load grid.
- Fixed nullref exception when using dynamic resources load policy and rolling back or resetting state while the resources are loading.
- Fixed managed text documents not generated for text provider components attached to printers and choice handlers of custom implementations.
- Fixed script line searcher limiting the minimum size above default values when attempting to resize the window.
- Fixed built-in choice handler, char printer and "ClickThroughPanel" UI being de-/serialized twice.
- Fixed UniTask v2 upgrade script not removing .meta file of the UniTask folder.
- Fixed `Skip On Input` option in movies configuration doesn't have any effect.
- Fixed custom commands tool generating incorrect metadata for list parameters with named values.
- Fixed bundled custom ncalc library causing conflicts when other ncalc library is used in the project.
- Fixed dropdowns in the game settings menu not updated when changing locale.
