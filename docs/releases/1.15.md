# 1.15 Release Notes

Release date: Nov 2020

> [!CAUTION]
> **This release is out of support and won't receive any new features or bug fixes.** Consider upgrading to the latest stable or preview release as soon as possible. Note that supported (stable and preview) releases are not published on Unity's Asset Store; [register your license](https://naninovel.com/register) to access them.

## Compatibility

Supported Unity versions range: from `2019.4.22` to `2020.3`. Previous versions are not supported; compatibility issues with newer (major) versions will be addressed once they're out of beta.

Recommended Unity version: [`2019.4.22`](https://unity3d.com/unity/whats-new/2019.4.22).

## Upgrade Guide

When importing the package to a project with Naninovel version `1.13` or older first follow [v1.14 release](/releases/1.14) upgrade guide, then continue with the following instructions:

1. Remove `Naninovel` folder from the project before importing the updated package.
2. In case you're using extension packages, update them using following links:
    - [NaninovelPlayMaker](https://github.com/Elringus/NaninovelPlayMaker/raw/master/NaninovelPlayMaker.unitypackage)
    - [NaninovelLive2D](https://github.com/Elringus/NaninovelLive2D/raw/master/NaninovelLive2D.unitypackage)
    - [AdventureCreator](https://github.com/Elringus/NaninovelAdventureCreator/raw/master/NaninovelAdventureCreator.unitypackage)
3. In case using a custom main camera prefab, set the desired orthographic size on the prefab (it's no longer set automatically when a custom camera is assigned). Automatically set size is evaluated as follows: `reference resolution height / PPU / 2`; height is 1080 and PPU is 100 by default, so the default size is `5.4`.
4. With the addition of [match mode](https://github.com/Naninovel/Documentation/blob/08cd4e3c91cde5ced9e5884e10266044520e6d32/docs/guide/backgrounds.md#match-mode) option for the background actors, revise how existing backgrounds should be matched to the screen ratio. In case using custom background actors, that aren't supposed to stretch to the entire screen, disable the matching by settings the property to "Disabled". In case using generic backgrounds, see [scale to match example](https://forum.naninovel.com/viewtopic.php?f=8&t=107&p=335#p335).
5. Naninovel will no longer override UI render mode, so in case using custom or modified UIs and text printers, make sure `Render Mode` is set to `Screen Space - Camera` and `Render Camera` field is empty. ([example](https://i.gyazo.com/d62bed3ba0c85972b12e759cc7b44c91.png))
6. If using new input system, update "Input System" package to version 1.1 via package manager.
7. To use the newly added blur effect, add `Naninovel/Prefabs/FX/Blur.prefab` to the spawn resources (Naninovel -> Resources -> Spawn).
8. In case using custom UIs inherited from built-in components, revise the prefabs configuration.
9. In case using poses, revise which modifications should be applied by enabling corresponding toggle boxes. ([example](https://i.gyazo.com/68df5c752bf2f8b7f45bbe890d2a3e26.png))
10. In case using speaker highlight feature, re-setup the config using character poses. ([example](https://i.gyazo.com/975b30da8318e075c34fc490cc526b85.png))
11. To use the newly added Toast UI, add `Naninovel/Prefabs/DefaultUI/ToastUI.prefab` to the UI resources (Naninovel -> Resources -> UI).
12. In case you've used quotes inside script expressions by double-escaping them, remove one escape symbol (single escape is enough now).
13. In case using custom chat printer message prefab, setup the typing state (if necessary) using the newly added `OnType` Unity events. ([example](https://i.gyazo.com/12eb10543b4eee6aff6497337cd9aa2a.png))

Remember to keep `NaninovelData/Resources` folder and `NaninovelData/EditorResources.asset` file when updating the engine to preserve project configuration and asset references.

Be aware, that in-game saves (slots in save/load menu, values in settings menu and global game state) created with previous versions could cause unexpected behavior when loaded with the updated version; when patching a shipped project with a new Naninovel version, make sure existing saves work as expected.

In case you're using [VS Code IDE extension](/guide/ide-extension), check for updates to handle changes in the commands API.

## Added

- Added spreadsheet extension allowing to export/import localizable project data (scenario, managed text and all the associated localization documents) to/from an `.xlsx` spreadsheet. ([guide](https://github.com/Naninovel/Documentation/blob/8177c7cf72aa902fdfa0d111e6588f9b345b7f76/docs/guide/spreadsheet.md))
- Added compatibility with Unity's new visual scripting solution. ([guide](https://github.com/Naninovel/Documentation/blob/b23e859e773a5fdc18a24c249aa4887c3b2a4565/docs/guide/visual-scripting.md))
- Added Spine character implementation. ([guide](https://git.io/JqZ6s))
- Added per-object blur FX. ([guide](https://github.com/Naninovel/Documentation/blob/f98f0c1e9607c6a115f4acd79c0942518d8b26f4/docs/guide/special-effects.md#blur))
- Added a toast UI and `@toast` command allowing to show general-purpose self-hiding popup notifications aka "toasts". ([guide](https://github.com/Naninovel/Documentation/blob/2c3f3f9831de1189c489ad12051f55c05278541d/docs/api/index.md#toast))
- Added an option to provide custom actor sprite shader, allowing to apply various lighting and surface effects. ([guide](https://github.com/Naninovel/Documentation/blob/ded713804f3bdf8923a5d3c034884d37cb36df2b/docs/guide/custom-actor-shader.md))
- Added `Match Mode` option to the background actor configuration allowing to specify in which mode the actor should be matched against the screen resolution. ([guide](https://github.com/Naninovel/Documentation/blob/08cd4e3c91cde5ced9e5884e10266044520e6d32/docs/guide/backgrounds.md#match-mode))
- Added `Reference PPU` property to the camera configuration allowing to control pixels per unit count when evaluating scene dimensions.
- Added `Match Screen Width` option to the camera configuration; when enabled, relative (scene) position evaluation will use screen border as the origin; otherwise a rectangle based on the reference resolution and PPU is used.
- Added `Arrange Range` property to character manager configuration, allowing to specify the range (relative to scene width) in which the characters are distributed by default. ([example](https://i.gyazo.com/eef2eef2ca9449f2ef4f81e58bcb2c35.png))
- Added `Update Delay` property to `React To Aspect Ratio` component allowing to specify frequency of the updates.
- Added `IsUnlocked()` built-in expression function, allowing to check wither an unlockable item with the specified ID is currently unlocked.
- Added video character implementation.
- Added detailed error description when an internal package asset is failed to load.
- Added `Default Font` option to UI configuration, allowing to specify a font option to apply by default when the game is first started.
- Added `Offset` property to `Render Canvas` component, allowing to specify an offset for the rendered layered or Live2D actor.
- Added `Default Base Reveal Speed` and `Default Base Auto Delay` properties to the text printers configuration, allowing to specify the related game settings values when the game is first started. ([example](https://i.gyazo.com/6ac049deb1a31f8045ad3afcc4a9158e.png))
- Added `Voice Source` property to character configuration, allowing to assign a dedicated audio source to be used when playing voice clips associated with the character. ([example](https://i.gyazo.com/0845d52c97ce45a5d0d9fd50eff17fb7.png))
- Added source and target language specs to the generated localization documents.
- Added `do` parameter to `@wait` command, allowing to execute specified commands after a delay. The wait command now also supports `wait:false` mode.
- Added `Stop Voice` property to text printer actor configuration; when enabled, the printer will stop any playing voices on each print command.
- Added `Activate On Move` to swipe input configuration, allowing to register the swipes while fingers are moved (disabled by default).
- Added default swipe bindings for open backlog and toggle UI inputs.
- Added `Touch Distance Limit` property to input configuration allowing to limit the touch distance when sampling input.
- Added `On Clicked` for CG gallery slot prefab allowing to specify custom behavior when an unlocked gallery slot is clicked.
- Added `Group By Category` option to resource provider configuration, allowing to group addressable resources by category. ([example](https://i.gyazo.com/80938ca5ca1021e8a71f783eef516d15.png))
- It's now possible to select a custom script parser in scripts configuration menu; to create a custom parser, implement `IScriptParser` interface. ([example](https://github.com/Naninovel/CustomParser))
- It's now possible to localize text printers and choice handlers in the same way as all the other resources.
- It's now possible to generate localization documents for all the available localization in the project at once by specifying path to the localization root directory (`Resources/Naninovel/Localization` by default). ([example](https://i.gyazo.com/4f0a6373755f0e122958f1f98de13013.png))
- It's now possible to provide custom implementation for audio player used by the audio manger service (selected in audio config).
- It's now possible to control z-position of text printer actors with `pos` parameter of `@printer` command.
- It's now possible to group multiple CG images into one gallery slot. ([guide](https://i.gyazo.com/ab7bcf7e903cc9153bfd3fbb96242875.png))
- It's now possible to selectively apply modifications in poses.
- It's now possible to modify chat message typing state without C# with the new `OnType` events added to the message prefab.
- It's now possible to prevent Naninovel from unloading Unity objects assigned as resources with `IResourceProviderManager.Hold` method.
- It's no longer required to enable "keep original pivot" in diced sprite atlas.
- It's no longer required to double-escape quotes inside script expressions (single escape is enough).
- Optimized shader keyword usage: all the built-in shader keywords are now local and don't count towards the global keyword limit.
- Optimized video actors resource usage: video clips will now be unloaded when the associated actor appearance is released.
- Optimized memory usage of TMPro printers text reveal effect.
- Optimized performance of applying managed text records to static fields.
- Optimized development console initialization performance.
- Optimized script and external script navigators initialization performance.
- Optimized grid slot UIs (save-load and CG gallery) performance: the grids no longer instantiate a game object per slot and instead re-bind the slots visible to player on pagination.
- Video actors now support tinting.
- Script graph now shows goto connections from choices.
- Script graph now automatically saved before rebuilding.
- Global state is now automatically saved when exiting the game.
- Text printers now support scaling (via `scale` parameter of `@printer` command).
- Improved performance of actors list editor window.
- Improved swipe detection: swipe will now be detected when finger traveled a specified distance instead of measuring the move speed.
- Improved resource loading performance and memory usage.
- Improved visual script editor performance when inspecting large scripts.
- Improved project resource provider performance while in editor.
- Improved build processing performance when using addressable asset system.
- Improved performance when editing layered actor prefab with gizmos enables.
- When disabling camera look mode, it's now possible to smoothly reset the offset, eg `@look false gravity:true speed:0.25`.
- Generated managed text records are now ordered by key.
- Scripts are now automatically re-imported when modified with an external application (eg, VS Code) even when Unity editor is not in focus.
- Visual script editor will now automatically highlight currently played line, even when it's not inside currently inspected script. Disable `Select Played Script` in script configuration to prevent this behavior.
- Character look direction is now animated (cross-faded) in the same way as all the other modifications.

## Changed

- Minimum supported Unity version changed to 2019.4.22 due to regression issues introduced in previous releases.
- Removed `Auto Correct Ortho Size` property from the camera configuration. Naninovel will no longer control camera size to adapt for the display aspect ratio. Instead, each background actor now has `Match Mode` property, allowing to specify the mode in which it should be adapted. For generic backgrounds see [scale to match example](https://forum.naninovel.com/viewtopic.php?f=8&t=107&p=335#p335).
- Removed `Default Ortho Size` and `Orthographic` properties from the camera configuration menu; use custom camera prefab to override the properties.
- Removed `Render Mode` and `Sorting Offset` from UI configuration. The properties will no longer be overridden for all the managed UIs; instead, set the desired values for each respective UI prefab individually (via `Canvas` component).
- Speaker highlight feature is now using character poses instead of tint color.
- Built-in UIs have been refactored for better extensibility (eg, text component references replaced with events, to allow using TMPro text instead of uGUI, custom button references changed to Unity buttons, etc).
- Default save data location in standalone (Windows, Mac, Unix) builds changed to [Application.persistentDataPath](https://docs.unity3d.com/ScriptReference/Application-persistentDataPath.html) for better compatibility.

## Fixed

- Fixed compatibility issues with Unity 2021.1 and 2021.2.
- Fixed `@char` command overrides being ignored when parsing generic text lines.
- Fixed actors getting clipped when display aspect ratio is higher than the reference one.
- Fixed zoom of `@camera` command ignoring field of view set in custom camera prefab.
- Fixed error occurring when state manager is requested in the constructor of a custom engine service.
- Fixed resources not preloaded on script hot reload.
- Fixed exceptions raised when using `Play Script` component in a custom title UI.
- Fixed print command with empty text causing script playback to stop.
- Fixed an excessive BOM character added to all the generated documents.
- Fixed camera look mode resets position when offsetting the camera.
- Fixed camera offset ignored when used right after despawning a looped shake FX.
- Fixed CG slots not loaded after changing language in game settings.
- Fixed text not completely revealed when rolling back to printer state with the same text content.
- Fixed layered actor behaviour canvas size gizmo not drawing by default.
- Fixed variable debug window not showing after exiting play mode with the window showed.
- Fixed error occurred when playing back voice and then performing rollback via backlog.
- Fixed layered actor composition not restored completely when loading a saved game.
- Fixed auto read mode not waiting for voice clips to finish before continuing.
- Fixed auto read mode not disabled when activating skip mode.
- Fixed TMPro bubble printer not working with tip tags.
- Fixed skip button on control panel not working when using new input system.
- Fixed auto arrange not working correctly when a character with render to texture option enabled is visible.
- Fixed character display name containing expression with custom variables not resolved correctly when loading a saved game.
- Fixed error when generating IDE metadata while duplicate layered actor composition map records are present.
- Fixed layered expression selection operator not affecting nested groups when layer name is omitted.
- Fixed an unexpected continue input activation when using keyboard, gamepad or touch to close a UI.
- Fixed Live2D characters not handling z-position animations correctly.
- Fixed nullref exception when a file without an extension is present in project resources directory.
- Fixed localization utility failing when "Try Update" option is disabled.
- Fixed next line skipped when initiating rewind while waiting for input.
- Fixed auto play stuck when playing a command inlined at the end of a generic text line.
- Fixed external scripts (community modding feature) fail to load.
- Fixed default input actions asset missing pause binding.
- Fixed exception when changing appearances of diced actors based on sprites with varying dimensions.
- Fixed diced actors with transparent borders on source texture not rendering correctly.
- Fixed scene backgrounds ignore tinting.
- Fixed scene background resources not unloading properly.
- Fixed CG slots not ordered properly in builds.
- Fixed script records duplicating in resource editor when building player without addressables package installed.
- Fixed chat printer not working correctly when printing multiple messages concurrently.
- Fixed "Naninovel" addressable group settings reset to default on build.
- Fixed UIs unavailable when using `IUIManager.GetUI` in `IManagedUI.InitializeAsync` method.
- Fixed resources not correctly preloaded when changing locale while a script is playing.
- Fixed input indicator not hiding when printing text with a play script component.
- Fixed formatting issues when mixing `<ruby>` and `<tip>` tags.
- Fixed author name clipped in built-in printers when setting larger text size in settings.
